select * from(SELECT row_number() over(ORDER BY SELECTION.TOTALSELECTED DESC,R32.STUDENTNO ASC) as row,
R32.STUDENTNO,STUDENTS.NAME AS STUDENTNAME,R32.COURSENO+R32.[GROUP] AS COURSENOGROUP,
COURSES.COURSENAME,COURSES.CREDITS,SELECTION.TOTALSELECTED,CAST(R32.INPROGRAM AS CHAR) AS INPROGRAM
FROM R32 JOIN COURSES ON R32.COURSENO=COURSES.COURSENO
INNER JOIN (
SELECT R32.YEAR,R32.TERM,R32.STUDENTNO,COUNT(*) AS TOTALSELECTED,COURSES.TYPE
FROM R32 INNER JOIN COURSES ON
R32.COURSENO=COURSES.COURSENO
WHERE COURSES.TYPE=:TONE
GROUP BY R32.STUDENTNO,R32.YEAR,R32.TERM,COURSES.TYPE) AS SELECTION
ON R32.STUDENTNO=SELECTION.STUDENTNO AND R32.YEAR=SELECTION.YEAR
AND R32.TERM=SELECTION.TERM AND COURSES.TYPE=SELECTION.TYPE
JOIN STUDENTS ON R32.STUDENTNO=STUDENTS.STUDENTNO
WHERE COURSES.TYPE=:TTWO
AND R32.YEAR=:YEAR
AND R32.TERM=:TERM
AND SELECTION.TOTALSELECTED>:LIMIT
) as b where b.row between :start and :end