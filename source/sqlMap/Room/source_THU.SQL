update TIMELIST SET THU=C.TT from TIMELIST INNER JOIN (
select B.TT,T.* from TIMELIST T INNER JOIN (
	select ROOMNO,dbo.group_or(OEWOPTIONS.TIMEBIT&TIMESECTIONS.TIMEBITS2) AS TT
	from SCHEDULE inner join OEWOPTIONS on SCHEDULE.OEW=OEWOPTIONS.CODE
	INNER JOIN TIMESECTIONS ON  SCHEDULE.TIME=TIMESECTIONS.NAME
	INNER JOIN TIMELIST t1 ON t1.WHO=SCHEDULE.ROOMNO AND t1.YEAR=SCHEDULE.YEAR AND t1.TERM=SCHEDULE.TERM
	where SCHEDULE.YEAR=:yone AND SCHEDULE.TERM=:tone
	and day=4
	group by ROOMNO
)AS B ON T.WHO=B.ROOMNO AND T.YEAR=:ytwo AND T.TERM=:ttwo

) AS C ON  C.WHO=TIMELIST.WHO AND C.YEAR=TIMELIST.YEAR AND C.TERM=TIMELIST.TERM
WHERE TIMELIST.YEAR=:ythree AND TIMELIST.TERM=:tthree