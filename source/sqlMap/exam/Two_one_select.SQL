select * from(SELECT row_number() over(order by RTRIM(dbo.getOne(TESTPLAN.FLAG))) as row,RTRIM(dbo.getOne(TESTPLAN.COURSENO)) AS kh,
RTRIM(dbo.getOne(COURSES.COURSENAME)) AS km,
RTRIM(dbo.getOne(TESTPLAN.ATTENDENTS)) AS xkrs,
RTRIM(dbo.getOne(TESTPLAN.ROOMNO1)) AS kcc1,
RTRIM(dbo.getOne(TESTPLAN.SEATS1)) as kw1,
RTRIM(dbo.getOne(TESTPLAN.ROOMNO2)) AS kcc2,
RTRIM(dbo.getOne(TESTPLAN.SEATS2)) as kw2,
RTRIM(dbo.getOne(TESTPLAN.ROOMNO3)) AS kcc3,
RTRIM(dbo.getOne(TESTPLAN.SEATS3)) as kw3,
RTRIM(dbo.getOne(RTRIM(CAST(TESTPLAN.FLAG AS CHAR)))) AS kssj2,
dbo.getOne('['+RTRIM(CAST(TESTPLAN.FLAG AS CHAR))+']'+[TESTBATCH].TESTTIME) AS kssj,
RTRIM(dbo.getOne((RTRIM(TESTPLAN.监考教师1)+ISNULL(TEACHER1.NAME,' ')) +','+RTRIM((RTRIM(TESTPLAN.监考教师2)+ISNULL(TEACHER2.NAME,' '))) +','+ RTRIM((RTRIM(TESTPLAN.监考教师3)+ISNULL(TEACHER3.NAME,' '))))) AS ST1,
RTRIM(dbo.getOne((RTRIM(TESTPLAN.监考教师4)+ISNULL(TEACHER4.NAME,' ')) +','+ RTRIM((RTRIM(TESTPLAN.监考教师5)+ISNULL(TEACHER5.NAME,' ')))+','+ RTRIM((RTRIM(TESTPLAN.监考教师6)+ISNULL(TEACHER6.NAME,' '))))) AS ST2,
RTRIM(dbo.getOne((RTRIM(TESTPLAN.监考教师7)+ISNULL(TEACHER7.NAME,' ')) +','+ RTRIM((RTRIM(TESTPLAN.监考教师8)+ISNULL(TEACHER8.NAME,' '))) +','+RTRIM((RTRIM(TESTPLAN.监考教师9)+ISNULL(TEACHER9.NAME,' '))))) AS ST3,
dbo.getOne((RTRIM(TESTPLAN.监考教师1)+ISNULL(TEACHER1.NAME,' '))) T1,
dbo.getOne((RTRIM(TESTPLAN.监考教师2)+ISNULL(TEACHER2.NAME,' '))) T2,
dbo.getOne((RTRIM(TESTPLAN.监考教师3)+ISNULL(TEACHER3.NAME,' '))) T3,
dbo.getOne((RTRIM(TESTPLAN.监考教师4)+ISNULL(TEACHER4.NAME,' '))) T4,
dbo.getOne((RTRIM(TESTPLAN.监考教师5)+ISNULL(TEACHER5.NAME,' '))) T5,
dbo.getOne((RTRIM(TESTPLAN.监考教师6)+ISNULL(TEACHER6.NAME,' '))) T6,
dbo.getOne((RTRIM(TESTPLAN.监考教师7)+ISNULL(TEACHER7.NAME,' '))) T7,
dbo.getOne((RTRIM(TESTPLAN.监考教师8)+ISNULL(TEACHER8.NAME,' '))) T8,
dbo.getOne((RTRIM(TESTPLAN.监考教师9)+ISNULL(TEACHER9.NAME,' '))) T9,
dbo.getOne(RTRIM(CAST(TESTPLAN.R15 AS CHAR))) AS R15,
dbo.GROUP_CONCAT_MERGE('['+COURSEPLAN.CLASSNO+']'+RTRIM(CLASSES.CLASSNAME),'/') AS bj,
dbo.getOne(TESTBATCH.TESTTIME) as TNAME,
RTRIM(dbo.getOne(testplan.rem)) as rem
FROM TESTPLAN 
JOIN COURSES ON LEFT(TESTPLAN.COURSENO,7)=COURSES.COURSENO AND COURSES.SCHOOL LIKE :COURSESCHOOL
LEFT OUTER JOIN TESTBATCH ON TESTPLAN.FLAG=TESTBATCH.FLAG AND   TESTPLAN.year = TESTBATCH.YEAR AND TESTPLAN.term = TESTBATCH.TERM
JOIN SCHEDULEPLAN ON TESTPLAN.R10=SCHEDULEPLAN.RECNO AND SCHEDULEPLAN.YEAR = :YEAR AND SCHEDULEPLAN.TERM = :TERM
JOIN COURSEPLAN ON LEFT(TESTPLAN.COURSENO,7)=COURSEPLAN.COURSENO AND RIGHT(TESTPLAN.COURSENO,2)=COURSEPLAN.[GROUP]
JOIN CLASSES ON COURSEPLAN.CLASSNO=CLASSES.CLASSNO AND CLASSES.SCHOOL LIKE :CLASSSCHOOL AND CLASSES.CLASSNO LIKE :CLASSNO AND SCHEDULEPLAN.YEAR=COURSEPLAN.YEAR AND SCHEDULEPLAN.TERM=COURSEPLAN.TERM
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER1 ON TESTPLAN.监考教师1=TEACHER1.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER2 ON TESTPLAN.监考教师2=TEACHER2.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER3 ON TESTPLAN.监考教师3=TEACHER3.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER4 ON TESTPLAN.监考教师4=TEACHER4.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER5 ON TESTPLAN.监考教师5=TEACHER5.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER6 ON TESTPLAN.监考教师6=TEACHER6.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER7 ON TESTPLAN.监考教师7=TEACHER7.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER8 ON TESTPLAN.监考教师8=TEACHER8.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER9 ON TESTPLAN.监考教师9=TEACHER9.TEACHERNO
WHERE TESTPLAN.FLAG LIKE :CHANGCI AND TESTPLAN.COURSENO LIKE :COURSENO and TESTPLAN.examType=:examType
GROUP BY TESTPLAN.COURSENO
) as b where b.row between :start and :end