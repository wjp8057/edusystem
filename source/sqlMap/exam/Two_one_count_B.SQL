select count(*) as ROWS from(SELECT row_number() over(order by dbo.getOne(TESTPLAN.COURSENO)) as row,dbo.getOne(TESTPLAN.COURSENO) AS kh,
dbo.getOne(COURSES.COURSENAME) AS km,
dbo.getOne(TESTPLAN.ATTENDENTS) AS xkrs,
dbo.getOne(TESTPLAN.ROOMNO1) AS kcc1,
dbo.getOne(TESTPLAN.SEATS1) as kw1,
dbo.getOne(TESTPLAN.ROOMNO2) AS kcc2,
dbo.getOne(TESTPLAN.SEATS2) as kw2,
dbo.getOne(TESTPLAN.ROOMNO3) AS kcc3,
dbo.getOne(TESTPLAN.SEATS3) as kw3,
dbo.getOne(RTRIM(CAST(TESTPLAN.FLAG AS CHAR))) AS kssj2,
dbo.getOne('['+RTRIM(CAST(TESTPLAN.FLAG AS CHAR))+']'+[L_考试时间表].NAME) AS kssj,
dbo.getOne(('['+RTRIM(TESTPLAN.监考教师1)+']'+ISNULL(TEACHER1.NAME,' ')) +','+ ('['+RTRIM(TESTPLAN.监考教师2)+']'+ISNULL(TEACHER2.NAME,' ')) +','+ ('['+RTRIM(TESTPLAN.监考教师3)+']'+ISNULL(TEACHER3.NAME,' '))) AS ST1,
dbo.getOne(('['+RTRIM(TESTPLAN.监考教师4)+']'+ISNULL(TEACHER4.NAME,' ')) +','+ ('['+RTRIM(TESTPLAN.监考教师5)+']'+ISNULL(TEACHER5.NAME,' '))+','+ ('['+RTRIM(TESTPLAN.监考教师6)+']'+ISNULL(TEACHER6.NAME,' '))) AS ST2,
dbo.getOne(('['+RTRIM(TESTPLAN.监考教师7)+']'+ISNULL(TEACHER7.NAME,' ')) +','+ ('['+RTRIM(TESTPLAN.监考教师8)+']'+ISNULL(TEACHER8.NAME,' ')) +','+('['+RTRIM(TESTPLAN.监考教师9)+']'+ISNULL(TEACHER9.NAME,' '))) AS ST3,

dbo.getOne(RTRIM(CAST(TESTPLAN.R15 AS CHAR))) AS R15,

dbo.getOne(testplan.rem) as rem
FROM TESTPLAN JOIN COURSES ON LEFT(TESTPLAN.COURSENO,7)=COURSES.COURSENO AND COURSES.SCHOOL LIKE :COURSESCHOOL
LEFT OUTER JOIN [L_考试时间表] ON TESTPLAN.FLAG=[L_考试时间表].UID
AND   TESTPLAN.year = [L_考试时间表].YEAR AND
      TESTPLAN.term = [L_考试时间表].TERM



LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER1 ON TESTPLAN.监考教师1=TEACHER1.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER2 ON TESTPLAN.监考教师2=TEACHER2.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER3 ON TESTPLAN.监考教师3=TEACHER3.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER4 ON TESTPLAN.监考教师4=TEACHER4.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER5 ON TESTPLAN.监考教师5=TEACHER5.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER6 ON TESTPLAN.监考教师6=TEACHER6.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER7 ON TESTPLAN.监考教师7=TEACHER7.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER8 ON TESTPLAN.监考教师8=TEACHER8.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME FROM TEACHERS )AS TEACHER9 ON TESTPLAN.监考教师9=TEACHER9.TEACHERNO
WHERE TESTPLAN.FLAG LIKE :CHANGCI AND TESTPLAN.COURSENO LIKE :COURSENO and TESTPLAN.examType=:examType
and TESTPLAN.year=:year and TESTPLAN.term=:term
GROUP BY TESTPLAN.COURSENO
) as b